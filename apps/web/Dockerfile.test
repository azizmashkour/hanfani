FROM mcr.microsoft.com/playwright:v1.49.0-noble

WORKDIR /app

# Install pnpm
RUN corepack enable && corepack prepare pnpm@10.27.0 --activate

COPY package.json pnpm-lock.yaml* ./
RUN pnpm install --frozen-lockfile || pnpm install

COPY . .

# Run unit tests then E2E tests
CMD ["sh", "-c", "pnpm test:run && pnpm test:e2e"]
